## 公钥、私钥、数字证书

公钥加密，私钥解密——用于加密信息，在TLS 协议（HTTPS）中主要用来协商对称密钥。

**对称加密过程中：**私钥加密（私钥仅用于签名加密），公钥解密——用于数字签名。数字签名相当于公告，告诉别人这是自己发送的，是自己用私钥加密过的，其他所有人都可以用公钥来解密进行验证。但是还得验证消息的未受篡改，所以对消息原文进行哈希，然后**用私钥加密这段哈希形成数字签名的第二部分**，接受方可以用公钥解密数字签名验证这段哈希是发送方发送的，同时对收到的消息原文（**将消息原文和签名一起，用接收方的公钥加密，生成密文**）进行哈希与收到的签名中的哈希进行比对，验证未收到篡改。

数字证书：为了防止客户端保存的公钥被替换，CA会用自己的私钥对客户端保存的公钥进行加密，只能用CA的公钥解密，形成了数字证书，保证公钥安全。为了将CA公钥安全转交给客户端，浏览器开发商发布版本时，会事先在内部植入常用认证机关的公开密钥。

在**TLS 协议（HTTPS）中**，服务器发送的消息原文则不是用私钥加密，而是用对称加密密钥加密的。公钥加密性能低，所以使用公私钥协商对称加密密钥，而后用这个对称密钥加密消息。对称密钥保存在服务器和客户端。

* 基于公钥加密的密钥交换：由客户端生成随机的会话密钥，然后用服务器的公钥加密，发送给服务器，以后就用这个会话密钥加密消息了。

* 当服务端和客户端使用对称密钥加密消息时，通常仍需要附带数字签名。

  > 对称密钥加密只保证消息被加密，不被直接查看，但无法确认消息是否在传输过程中被篡改（密钥泄露导致攻击者伪造消息）。数字签名通过哈希验证可以检测数据完整性。
  >
  > 对称密钥加密中，双方都持有密钥，任何一方都可以加密数据，因此无法防止发送方否认发送了某条消息。数字签名绑定发送方的私钥，具备不可否认性。
  >
  > **对称加密过程中消息原文用对称密钥（AES）加密**



##  TCP三次握手

### 第 2 次握手传回了ACK，为什么还要传回SYN?

发送的 ACK 只是为了响应客户端的请求，表明了客户端到服务端通信正常，但是未体现出服务端想要连接的意愿。

发送SYN是为了让服务器也建立一条连接。TCP连接是双向的，需要双方都要发起连接，通过发送自己的初始序列号即SYN，来发起连接请求。

## 四次挥手

第一次挥手客户端发送想要关闭连接的意愿。（FIN）客户端：进入Fin-wait-1

第二次挥手服务端确认了发送端的请求。（ACK）服务端：close-wait 客户端：Fin-wait-2

然后此时服务端还会处理没处理完的请求并给出这些请求的响应。

第三次挥手服务端发送关闭连接的意愿。（FIN）服务端：last-ack状态

第四次挥手客户端发送ACK，然后等待**2MSL（报文段最长寿命，一个片段在网络中最大的存活时间，2MSL 就是一个发送和一个回复所需的最大时间。）**时间后就关闭连接。（ACK）客户端：Time-wait状态，服务端收到后：close状态。





